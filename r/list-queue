#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <ctype.h>

char stack[100];
int top = 0;
char exp[100];

struct table
{
    char s[2];
    int isp;
    int icp;
} pr[7];

/* Function to get in-stack precedence */
int isp(char c)
{
    for (int i = 0; i <= 6; i++)
        if (pr[i].s[0] == c)
            return pr[i].isp;
    return 0;
}

/* Function to get incoming precedence */
int icp(char c)
{
    for (int i = 0; i <= 6; i++)
        if (pr[i].s[0] == c)
            return pr[i].icp;
    return 0;
}

int main()
{
    int i;
    // clrscr(); // Optional, remove if not using Turbo C

    // Initialize operator precedence table
    strcpy(pr[0].s, "^"); pr[0].isp = 3; pr[0].icp = 4;
    strcpy(pr[1].s, "*"); pr[1].isp = 2; pr[1].icp = 2;
    strcpy(pr[2].s, "/"); pr[2].isp = 2; pr[2].icp = 2;
    strcpy(pr[3].s, "+"); pr[3].isp = 1; pr[3].icp = 1;
    strcpy(pr[4].s, "-"); pr[4].isp = 1; pr[4].icp = 1;
    strcpy(pr[5].s, "("); pr[5].isp = 0; pr[5].icp = 4;
    strcpy(pr[6].s, "="); pr[6].isp = -1; pr[6].icp = 0;

    stack[top] = '='; // Initialize stack with sentinel

    printf("Enter the infix expression: ");
    fgets(exp, sizeof(exp), stdin);
    exp[strcspn(exp, "\n")] = 0; // remove newline if present

    i = 0;
    printf("The postfix expression is: ");

    while (i < strlen(exp))
    {
        char ch = exp[i];

        if (isalpha(ch) || isdigit(ch))
        {
            printf("%c", ch); // operand directly to output
        }
        else
        {
            if (ch == ')')
            {
                while (stack[top] != '(')
                {
                    printf("%c", stack[top]);
                    top--;
                }
                top--; // pop '('
            }
            else
            {
                while (isp(stack[top]) >= icp(ch))
                {
                    printf("%c", stack[top]);
                    top--;
                }
                top++;
                stack[top] = ch;
            }
        }
        i++;
    }

    // Pop remaining operators
    while (top > 0)
    {
        printf("%c", stack[top]);
        top--;
    }

    printf("\n");
    return 0;
}
