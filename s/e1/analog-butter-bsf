%Program for Butterworth IIR Bandstopanalog filter 
clc; 
close all; 
clear all; 
fprintf('Program for Butterworth IIR Lowpass analog filter\n\n'); 

%We get the passedge, stopedge frequencies in rad/s 

here use values as : 
pass edge - 300
stop edge - 1000
pass edge - 2000
stop edge - 4000

OMEGAP1=input('Please enter the pass edge frequency in rad/s:'); 
OMEGAS1=input('Please enter the stop edge frequency in rad/s:'); 
OMEGAS2=input('Please enter the stop edge frequency in rad/s:'); 
OMEGAP2=input('Please enter the pass edge frequency in rad/s:'); 

%We get the gain magnitudes 
%delp will be around 0.7 to 0.9 
%dels will be around 0.1 to 0.3 

delp = input('\nenter the passband magnitude:'); 
dels = input('\nenter the stopband magnintude:'); 

%We will convert magnitudes to attenuation in dB 
%since the buttord command used only these attenuation values 

here the values for : 
passband ripple - 3
stopband ripple - 50 

rp = -20*log10(delp); 
rs = -20*log10(dels); 

%Computing the order(N) and cutoff frequency(wc) using wp,ws,rp,rs using 
%thebuttord command with 's' option for analog filter. 
%Finding the coefficients of filter[b a] using butter command with 's' 
%option and 'stop' keyword 

OMEGAP = [OMEGAP1 OMEGAP2]; 
OMEGAS = [OMEGAS1 OMEGAS2]; 
[N wc]=buttord(OMEGAP,OMEGAS,rp,rs,'s'); 
[b a]=butter(N,wc,'stop','s'); 

%Computing the frequency response using freqs command 
%We find h for different values of omega. 
%and storing the corresponding the w values 

omega=0:1:2*OMEGAP2; 
[h omega] = freqs(b,a,omega); 

%Finding the magnitude response. Note: log10 should be used. 
%Plotting magnitude versus omega. 
%Since the specification is in dB, we will plot in dB 

mag_h=abs(h); 
figure(1); 
subplot(2,1,1); 
plot(omega,mag_h); 
xlabel('angular frequency i.e. omega -->'); 
ylabel('Gain-->'); 
title('Magnitude response of BSF'); 

%Finding the phase response. 
%Plotting phase versus omega. 

angle_h = angle(h); 
subplot(2,1,2); 
plot(omega,angle_h) 
xlabel('angular frequency i.e. omega -->'); 
ylabel('Phase in radian-->'); 
title('Phase response of BSF');
