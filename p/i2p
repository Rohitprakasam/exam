#include <stdio.h>
#include <string.h>
#include <ctype.h>
#include <stdlib.h>

char stack[100];
int top = -1; // Standard practice: start at -1 so first element is 0
char ex[100];

struct table {
    char s[2];
    int isp; // In-Stack Priority
    int icp; // Incoming-Character Priority
} pr[7];

int get_isp(char c) {
    for (int i = 0; i <= 6; i++)
        if (pr[i].s[0] == c) return (pr[i].isp);
    return -1;
}

int get_icp(char c) {
    for (int i = 0; i <= 6; i++)
        if (pr[i].s[0] == c) return (pr[i].icp);
    return -1;
}

void main() {
    // Initializing the precedence table
    strcpy(pr[0].s, "^"); pr[0].isp = 3;  pr[0].icp = 4;
    strcpy(pr[1].s, "*"); pr[1].isp = 2;  pr[1].icp = 2;
    strcpy(pr[2].s, "/"); pr[2].isp = 2;  pr[2].icp = 2;
    strcpy(pr[3].s, "+"); pr[3].isp = 1;  pr[3].icp = 1;
    strcpy(pr[4].s, "-"); pr[4].isp = 1;  pr[4].icp = 1;
    strcpy(pr[5].s, "("); pr[5].isp = 0;  pr[5].icp = 4;
    strcpy(pr[6].s, "="); pr[6].isp = -1; pr[6].icp = 0;

    stack[++top] = '='; // Push ground symbol

    printf("Enter the infix expression: ");
    fgets(ex, 100, stdin);
    
    // Remove newline character if present from fgets
    ex[strcspn(ex, "\n")] = 0;

    printf("The postfix expression is: ");
    int i = 0;
    while (i < strlen(ex)) {
        if (isalnum(ex[i])) { // If it's an operand (letter or number)
            printf("%c", ex[i]);
        } 
        else if (ex[i] == ')') {
            while (top >= 0 && stack[top] != '(') {
                printf("%c", stack[top--]);
            }
            top--; // Pop '('
        } 
        else { // It's an operator or '('
            while (top >= 0 && get_isp(stack[top]) >= get_icp(ex[i])) {
                printf("%c", stack[top--]);
            }
            stack[++top] = ex[i];
        }
        i++;
    }

    // Pop remaining operators from stack
    while (top > 0) { // Don't pop the '=' ground symbol
        printf("%c", stack[top--]);
    }
    printf("\n");
}
